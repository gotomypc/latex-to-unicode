require './data.rb'
require './translate.rb'

module LatexToUnicode
  grammar Latex
    rule expression
      ( superscript / subscript / bracketed / atoms )* {
        def value
          elements.map {|x| x.value }.join
        end
      }
    end

    rule superscript
      '^' element {
        def value
          LatexToUnicode::translate(element.value, LatexToUnicode::SUPERSCRIPTS)
        end
      }
    end

    rule subscript
      '_' element {
        def value
          LatexToUnicode::translate(element.value, LatexToUnicode::SUBSCRIPTS)
        end
      }
    end
    
    rule element
      bracketed / atom
    end

    rule bracketed
      '{' atoms '}' {
        def value
          atoms.value
        end
      } 
    end

    rule atoms
      atom+ {
        def value
          text_value
        end
      }
    end

    rule atom
      [^{}\^_] {
        def value
          text_value
        end
      }
    end
  end
end
